<!DOCTYPE html>

<html>

<head>
	<title>VR Physics</title>
	<!-- Favicon -->
	<link rel="icon" href="/images/hunna.jpg" type="image/jpeg" sizes="16x16">

	<!-- Styling -->
	<link rel="stylesheet" type="text/css" href="/css/styles.css" />
	
	<script type="text/javascript" src="js/three.min.js"></script>
	<script type="text/javascript" src="js/stats.js"></script>
	<script type="text/javascript" src="js/physi.js"></script>
	
	<!-- Leap -->
	<script src="https://js.leapmotion.com/leap-0.6.4.js"></script>
	<script src="https://js.leapmotion.com/leap-plugins-0.1.12.js"></script>

	<!-- Webvr -->
	<script src="js/vr/ViveController.js"></script>
	<script src="js/vr/WebVR.js"></script>
	<script src="js/loaders/OBJLoader.js"></script>

	<!-- JQuery -->
	<script
	src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
	integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
	crossorigin="anonymous">
	</script>

	<!-- Custom code -->
	<script src ="js/leap.js"></script>
	<script src ="js/hands.js"></script>
	<script src ="js/scene.js"></script>

	<!-- Engine -->
	<script type="text/javascript">
		var currentframe = 0; //most recent leap data
		var leapcontroller; 	// for getting leap data
		'use strict';

		Physijs.scripts.worker = 'js/physijs_worker.js';
		Physijs.scripts.ammo = 'ammo.js';
		/////////////////////////////////////////////
		//				Init Variables			   //
		/////////////////////////////////////////////
		var hand_offset_to_camera = new THREE.Vector3(0,-7,0);
		var test_block, draw_hands, init_world, initEventHandling, draw_test_block, currmousex, currmousey, render, createTower, loader,
		renderer, render_stats, physics_stats, scene, dir_light, am_light, camera,
		table, blocks = [], lhand, rhand,lbock,rblock,table_material, block_material, intersect_plane,
		selected_block = null, mouse_position = new THREE.Vector3, block_offset = new THREE.Vector3, _i, _v3 = new THREE.Vector3;
		var touched_block;
		var lastfingertippos;
		var boneMeshes = [];
		var oldpos;
		var checking_collisions = false;
		var mesh;
		var clock = new THREE.Clock();
		
		var pinching = false;
		var worldscale = 1;
		function init_stats (argument) {
			//init stats module
			render_stats = new Stats();
			render_stats.domElement.style.position = 'absolute';
			render_stats.domElement.style.top = '1px';
			render_stats.domElement.style.zIndex = 100;
			document.getElementById( 'viewport' ).appendChild( render_stats.domElement );
			//init stats module
			// physics_stats = new Stats();
			// physics_stats.domElement.style.position = 'absolute';
			// physics_stats.domElement.style.top = '50px';
			// physics_stats.domElement.style.zIndex = 100;
			// document.getElementById( 'viewport' ).appendChild( physics_stats.domElement );
		}
		
		
		init_world = function() {
			init_renderer();
			
			// init_effect();
			init_stats();
			init_scene();
			init_user();
			window.addEventListener( 'resize', onWindowResize, false );
			document.addEventListener('keydown', keyPressed, false);
			//oculuscontrol.connect();//presumably engages oculus tracking REQUIRES SERVER THAT IS NOT INSTALLED
			//initEventHandling();
			
		};
		//from the effect demo
		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
		}
		
		
		var lastpinching = false;		
		render = function() {
			if(currentframe !=0){
				draw_hands();
				handlepinch();
			}
			requestAnimationFrame( render );
			renderer.render( scene, camera );
			scene.simulate( undefined, 1 );
			render_stats.update();
		};
		function keyPressed(event) {
			
			if(event.keyCode === 85) {
				//u key
				hand_offset_to_camera.y += .25;
			}
			if(event.keyCode === 79) {
				//o key
				hand_offset_to_camera.y -= .25;
			}if(event.keyCode === 73) {
				//i key
				hand_offset_to_camera.z += .25;
			}
			if(event.keyCode === 75) {
				//k key
				hand_offset_to_camera.z -= .25;
			}
			if(event.keyCode === 76) {
				//i key
				hand_offset_to_camera.x += .25;
			}
			if (event.keyCode === 74) { 
				//j key
				//$("#heading").toggle();
				checking_collisions = !checking_collisions;
				console.log("Checking collisions is "+checking_collisions);
				//hand_offset_to_camera.x -= .25;
			}
		}
		function init_all(){
				// init_vars();
				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.innerHTML = '<a href = "https://github.com/QuinnCiccoretti/ResProject">htc vive + webvr + physijs</a>';
				document.getElementById( 'viewport' ).appendChild( info );
				$(".load").hide();
				init_world();
				init_leap(); 

			}
		window.addEventListener("keypress", keyPressed, false);
		window.addEventListener("resize", onWindowResize);
		window.onload = init_all;
	</script>
	
</head>

	<body>
	<div class="load" id="loader"></div>
	<!-- <div id="heading">
		<h1>Jenga</h1>
		<p>Click & drag on the blocks to move them around.</p>
	</div> -->
	<div id="viewport"></div>
</body>

</html>
